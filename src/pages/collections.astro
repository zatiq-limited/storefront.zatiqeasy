---
/**
 * ========================================
 * COLLECTIONS PAGE
 * ========================================
 *
 * Dynamic collections page - sections from API, just like homepage and products page
 *
 * Backend API Endpoint: GET /api/storefront/v1/page/collections
 */

import Layout from '../layouts/main.astro';
import CollectionsPageRenderer from '../components/CollectionsPageRenderer';
import { getCollectionsPageData } from '../lib/api-client';

// Enable server-side rendering
export const prerender = false;

// Fetch collections page data from API (sections + collections combined)
let pageData: any = null;
let sections: any[] = [];
let collections: any[] = [];
let seo: any = {};

try {
	pageData = await getCollectionsPageData();

	if (pageData) {
		sections = pageData.sections || [];
		collections = pageData.collections || [];
		seo = pageData.seo || {};
	}
} catch (error) {
	console.error('[Collections Page] Failed to load data:', error);
}

// Dynamic title
const title = seo?.title || 'Shop by Collections';
---

<Layout
	title={`${title} | ZatiqEasy`}
	description={seo?.description || "Browse our curated collections and find your perfect style"}
	image={seo?.og?.image}
>
	<main class="zatiq-collections-page">
		<CollectionsPageRenderer
			sections={sections}
			collections={collections}
			client:load
		/>
	</main>
</Layout>
