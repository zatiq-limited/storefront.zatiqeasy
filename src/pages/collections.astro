---
/**
 * ========================================
 * COLLECTIONS PAGE
 * ========================================
 * 
 * Display all available collections
 * Fully API-driven from category.json
 */

import Layout from '../layouts/main.astro';

// Enable server-side rendering
export const prerender = false;

// Fetch collections from API
let collectionsData: any = null;
let collections: any[] = [];

try {
	const API_BASE_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:3001';
	const response = await fetch(`${API_BASE_URL}/api/storefront/v1/collections`);
	const result = await response.json();
	
	if (result.success && result.data?.categories) {
		collections = result.data.categories;
	}
} catch (error) {
	console.error('[Collections Page] Failed to load collections:', error);
}
---

<Layout 
	title="Shop by Collections | ZatiqEasy"
	description="Browse our curated collections and find your perfect style"
>
	
	<!-- Page Header -->
	<section class="relative bg-black text-white py-24 overflow-hidden">
		<!-- Background Pattern -->
		<div class="absolute inset-0 opacity-10">
			<div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cg fill=\'none\' fill-rule=\'evenodd\'%3E%3Cg fill=\'%23ffffff\' fill-opacity=\'1\'%3E%3Cpath d=\'M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
		</div>
		
		<div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
			<div class="inline-block mb-4">
				<span class="px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full text-sm font-medium uppercase tracking-wider">
					Curated Collections
				</span>
			</div>
			<h1 class="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 tracking-tight">
				Discover Your Style
			</h1>
			<p class="text-xl md:text-2xl text-gray-300 max-w-3xl mx-auto leading-relaxed">
				Explore our handpicked collections crafted for every occasion and trend
			</p>
		</div>
	</section>

	<!-- Collections Grid -->
	<section class="py-16 md:py-24 bg-gray-50">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			{collections && collections.length > 0 ? (
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8">
					{collections.map((collection: any, index: number) => (
						<div 
							class={`group ${
								index === 0 ? 'md:col-span-2 md:row-span-2' : ''
							}`}
							style={`animation: fadeInUp 0.6s ease-out ${index * 0.1}s both;`}
						>
							<!-- Main Collection Card -->
							<a 
								href={`/collections/${collection.id}`}
								class="block relative overflow-hidden rounded-2xl bg-white shadow-lg hover:shadow-2xl transition-all duration-300"
							>
								<!-- Collection Image Container -->
								<div class={`relative overflow-hidden ${
									index === 0 ? 'aspect-[16/9]' : 'aspect-[4/3]'
								}`}>
									{collection.banner_url ? (
										<img 
											src={collection.banner_url} 
											alt={collection.name}
											class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
											loading="lazy"
										/>
									) : (
										<img 
											src={collection.image_url} 
											alt={collection.name}
											class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
											loading="lazy"
										/>
									)}
									
									<!-- Strong Dark Overlay -->
									<div class="absolute inset-0 bg-gradient-to-t from-black/95 via-black/60 to-black/20"></div>
									
									<!-- Product Count Badge -->
									<div class="absolute top-4 right-4 z-10">
										<div class="bg-white px-4 py-2 rounded-lg shadow-xl">
											<span class="text-sm font-bold text-gray-900">
												{collection.product_count}
											</span>
											<span class="text-sm text-gray-600 ml-1">items</span>
										</div>
									</div>

									<!-- Collection Info -->
									<div class="absolute bottom-0 left-0 right-0 p-6 md:p-8 z-10">
										<h2 class={`font-bold text-white mb-3 ${
											index === 0 ? 'text-3xl md:text-4xl' : 'text-xl md:text-2xl'
										}`}>
											{collection.name}
										</h2>
										
										{collection.description && (
											<p class={`text-white/95 line-clamp-2 mb-4 ${
												index === 0 ? 'text-base md:text-lg' : 'text-sm'
											}`}>
												{collection.description}
											</p>
										)}

										<!-- View Button -->
										<div class="mt-4 inline-flex items-center gap-2 px-4 py-2 bg-white text-gray-900 font-semibold text-sm rounded-lg hover:bg-gray-100 transition-all group-hover:gap-3">
											<span>View Collection</span>
											<svg 
												class="w-4 h-4 transition-transform group-hover:translate-x-1" 
												fill="none" 
												stroke="currentColor" 
												viewBox="0 0 24 24"
												stroke-width="2.5"
											>
												<path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
											</svg>
										</div>
									</div>
								</div>
							</a>

							<!-- Subcategories Grid -->
							{collection.children && collection.children.length > 0 && (
								<div class="mt-4 grid grid-cols-3 gap-3">
									{collection.children.slice(0, 3).map((child: any) => (
										<a 
											href={`/collections/${child.id}`}
											class="group/child block relative overflow-hidden rounded-xl bg-white shadow hover:shadow-lg transition-all duration-300"
										>
											<div class="relative aspect-square overflow-hidden">
												<img 
													src={child.image_url} 
													alt={child.name}
													class="w-full h-full object-cover transition-transform duration-500 group-hover/child:scale-110"
													loading="lazy"
												/>
												<!-- Dark overlay for text visibility -->
												<div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/50 to-transparent"></div>
												
												<!-- Text overlay on image -->
												<div class="absolute bottom-0 left-0 right-0 p-3 z-10">
													<p class="text-white font-bold text-sm leading-tight mb-1">
														{child.name}
													</p>
													<p class="text-white/90 text-xs">
														{child.product_count} items
													</p>
												</div>
											</div>
										</a>
									))}
								</div>
							)}
						</div>
					))}
				</div>
			) : (
				<!-- Empty State -->
				<div class="text-center py-24">
					<div class="inline-block p-6 bg-white rounded-full shadow-lg mb-6">
						<svg 
							class="w-16 h-16 text-gray-400" 
							fill="none" 
							stroke="currentColor" 
							viewBox="0 0 24 24"
						>
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
						</svg>
					</div>
					<h2 class="text-3xl font-bold text-gray-900 mb-3">No Collections Yet</h2>
					<p class="text-gray-600 mb-8 text-lg">Our team is curating amazing collections. Check back soon!</p>
					<a 
						href="/" 
						class="inline-flex items-center gap-2 px-8 py-4 bg-black text-white font-semibold rounded-full hover:bg-gray-800 transition-colors"
					>
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
						</svg>
						Back to Home
					</a>
				</div>
			)}
		</div>
	</section>

	<!-- CTA Section -->
	{collections && collections.length > 0 && (
		<section class="relative py-24 bg-gradient-to-br from-gray-900 via-black to-gray-900 text-white overflow-hidden">
			<!-- Decorative Elements -->
			<div class="absolute top-0 left-0 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl"></div>
			<div class="absolute bottom-0 right-0 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl"></div>
			
			<div class="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
				<h2 class="text-4xl md:text-5xl font-bold mb-6">
					Still Exploring?
				</h2>
				<p class="text-xl text-gray-300 mb-10 max-w-2xl mx-auto">
					Dive into our complete catalog or search for something specific
				</p>
				<div class="flex flex-col sm:flex-row gap-4 justify-center">
					<a 
						href="/products" 
						class="group px-8 py-4 bg-white text-black font-semibold rounded-full hover:bg-gray-100 transition-all inline-flex items-center justify-center gap-2"
					>
						<span>Browse All Products</span>
						<svg class="w-5 h-5 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
						</svg>
					</a>
					<a 
						href="/search" 
						class="px-8 py-4 bg-white/10 backdrop-blur-sm text-white font-semibold rounded-full border-2 border-white/20 hover:bg-white/20 transition-all inline-flex items-center justify-center gap-2"
					>
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
						</svg>
						<span>Search</span>
					</a>
				</div>
			</div>
		</section>
	)}

	<style>
		/* Line clamp utility */
		.line-clamp-2 {
			display: -webkit-box;
			-webkit-line-clamp: 2;
			-webkit-box-orient: vertical;
			overflow: hidden;
		}

		/* Fade in animation */
		@keyframes fadeInUp {
			from {
				opacity: 0;
				transform: translateY(30px);
			}
			to {
				opacity: 1;
				transform: translateY(0);
			}
		}
	</style>
</Layout>
