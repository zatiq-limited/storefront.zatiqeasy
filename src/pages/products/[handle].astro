---
/**
 * ========================================
 * PRODUCT PAGE
 * ========================================
 * 
 * Backend API Endpoints:
 * 
 * GET /api/storefront/v1/products/:handle
 * - Returns: Product details with variants
 * 
 * GET /api/storefront/v1/products/recommendations?productId=:id
 * - Returns: Related/recommended products
 * 
 * GET /api/storefront/v1/reviews/:productId
 * - Returns: Product reviews
 */

import Layout from '../../layouts/main.astro';
import TemplateRenderer from '../../components/TemplateRenderer';
import { mockTheme } from '../../data/mock-theme';
import { mockProducts } from '../../data/mock-products';

// Get handle from URL
const { handle } = Astro.params;

// Get product template from theme
const productTemplate = mockTheme.templates.product;

// In production, fetch from API
// const product = await fetch(`/api/storefront/v1/products/${handle}`).then(r => r.json())
const product = mockProducts.find(p => p.handle === handle);

if (!product) {
	return Astro.redirect('/404');
}

// Fetch recommendations
// const recommendations = await fetch(`/api/storefront/v1/products/recommendations?productId=${product.id}`).then(r => r.json())
const recommendations = mockProducts.filter(p => p.id !== product.id).slice(0, 4);
---

<Layout 
	title={`${product.title} | ${mockTheme.templates.index.seo?.title}`}
	description={product.description}
	image={product.images[0]}
>
	<TemplateRenderer template={productTemplate} client:load />
</Layout>
